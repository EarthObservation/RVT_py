# Upload to anaconda.org

These instructions explain how to build and upload the `rvt_py` package from PyPI to Anaconda.org.

All commands should be executed from an activated Anaconda virtual environment. On Windows, use `Anaconda Prompt`..

> **Important:**
>
> - All build scripts are located in the `upload_to_conda` folder.
> - Before starting a new build, always remove any folders containing previous builds.


---


## Recommended Best Practice:

* Always ensure **version consistency** between `noarch` and platform-specific (`win-64`) builds to avoid unexpected behavior.
* Prefer **platform-specific builds** if your package depends on libraries with native binaries (e.g., GDAL, NumPy).

This ensures compatibility, optimal performance, and predictable package selection by Conda.

Starting from version **2.2.2**, we create two types of packages:

- `win-64`: optimized specifically for Windows
- `noarch`: platform-independent

While Windows is our primary supported platform, we want the package accessible to users on other platforms.


---


## Preparation

### Step 1: Publish the new version to PyPI

First, upload the new version of the package to PyPI (used as the source for the Conda build).

### Step 2: Prepare your build environment

Ensure necessary tools are installed:

```bash
conda install conda-build anaconda-client conda-verify
```

### Step 3: Update `meta.yaml`

Edit `meta.yaml`:

- Update the package version number (**line 2**).
- Update the SHA256 checksum to match the PyPI release:
  - Go to [PyPI rvt-py files](https://pypi.org/project/rvt-py/#files)
  - Click "View hashes" under the source distribution.
- *Update dependencies in the `requirements` section if necessary.*

### Step 4: Set working directory

Ensure youâ€™re in the correct directory:

```bash
cd upload_to_conda
```

### Step 5: Login to Anaconda.org

Log in using your credentials:

```bash
anaconda login --username rvtpy --password {*}
```

Replace `{*}` with your Anaconda.org password.

> **For rvt-py developers>**
> 
> `rvt-py` is the shared user account, developers can also publish using their individual accounts

### Optional: Disable/enable automatic upload

While automatic upload reduces manual steps, it also reduces control over the build process and increases the risk of
accidentally publishing broken or incorrect builds. If on, the upload occurs automatically at the end of the build
process, allowing you to skip the final step.

Check your current configuration:

```bash
conda config --show anaconda_upload
```

To disable (to enable change `no` to `yes`) run:

```bash
conda config --set anaconda_upload no
```

---

## Building and uploading `win-64` package

### Step 1: Modify `meta.yaml` for a platform-specific build

Remove or comment out this line in `meta.yaml`:

```yaml
# noarch: python
```

### Step 2: Build the Windows package

Run the following command:

```bash
conda build .\rvt-py --output-folder .\conda_packages
```

The built package will appear here:

```
.\conda_packages\win-64\rvt_py-<version>-pyXX.conda
```

Replace `<version>` and `pyXX` with the correct details.

### Step 3: Upload Windows package

Upload the built package to your Anaconda.org channel (`rvtpy`):

```bash
conda upload .\conda_packages\win-64\rvt_py-<version>-*.conda
```

Replace `<version>` appropriately.

---

## Building and uploading `noarch` package

### Step 1: Ensure `meta.yaml` specifies `noarch`

Make sure `meta.yaml` includes (this line was removed or commented out when building for `win-64`):

```yaml
build:
  noarch: python
```

### Step 2: Build the package

Run the build:

```bash
conda build rvt-py --output-folder .\conda_packages
```

Built packages (`*.conda`) will appear in the `.\conda_packages` folder.

### Step 3: Upload the package

Upload the built package to Anaconda.org:

```bash
anaconda upload .\conda_packages\noarch\rvt_py-<version>-*.conda
```

Replace `<package_name>` with the actual filename generated by the build.

---

You're done! The package is now available on Anaconda.org.
